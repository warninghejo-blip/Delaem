# Алгоритм генерации x-sign (НАЙДЕН)

## Источник
Код найден в файле `pages/_app-2637cbcbd7da64c9.js` (функция `eh`)

## Алгоритм

### Шаг 1: Формирование строки J

```javascript
let J = (S.baseURL || "") + S.url;  // URL без домена
J = J.replace(/https?:\/\/[^/]+/, "");  // Убираем домен

// Для GET запросов:
if (method === "GET" && params) {
    // Добавляем параметры как query string
    for (let key in params) {
        if (params[key] != null) {
            // Функция ep - специальное кодирование
            const encodedValue = encodeURIComponent(params[key])
                .replace(/'/g, "%27")
                .replace(/%3A/gi, ":")
                .replace(/%24/g, "$")
                .replace(/%2C/gi, ",")
                .replace(/%20/g, "+")
                .replace(/%5B/gi, "[")
                .replace(/%5D/gi, "]");
            if (J.includes("?")) {
                J += `&${key}=${encodedValue}`;
            } else {
                J += `?${key}=${encodedValue}`;
            }
        }
    }
    J += "\n";
    J = J.replaceAll("•", "%E2%80%A2");
}

// Для POST запросов:
if (method === "POST" && data) {
    J += "\n";
    J += JSON.stringify(data);
}

// Добавляем timestamp + разделитель + дополнительная строка
J += "\n" + timestamp + "@#?.#@" + X((0, U.$i)());
```

### Шаг 2: Генерация хеша

```javascript
function ei(S) {
    return new en().update(S).digest((0, U.ms)());
}

// Где:
// - en - это хеш-объект (вероятно, MD5 или SHA-256)
// - U.ms() - метод для получения hex строки
// - Результат: 32 символа (hex)
```

### Шаг 3: Установка в headers

```javascript
S.headers[ea((0, U.tt)())] = ei(J);  // x-sign
S.headers[eo((0, U.Q9)())] = I;        // x-ts
```

## Неизвестные детали

1. **`X((0, U.$i)())`** - дополнительная строка в конце `J`
   - Может быть случайной строкой
   - Может быть еще одним timestamp
   - Может быть пустой строкой

2. **`en`** - тип хеша
   - MD5 (32 символа) - более вероятно
   - SHA-256 (первые 32 символа) - также возможно

3. **`ea()` и `eo()`** - функции для получения имен заголовков
   - Вероятно, возвращают `"x-sign"` и `"x-ts"`

## Реализация в worker.js

Реализована упрощенная версия алгоритма:
- Формируется строка `J` из URL + параметры + `\n` + timestamp + `"@#?.#@"`
- Используется SHA-256 (первые 32 символа)
- Дополнительная строка `X((0, U.$i)())` пока не учитывается

## Тестирование

Для проверки правильности алгоритма нужно:
1. Сгенерировать `x-sign` для известного URL и timestamp
2. Сравнить с реальным значением из браузера
3. Если не совпадает - попробовать MD5 вместо SHA-256
4. Если все еще не совпадает - добавить дополнительную строку

## Примеры из браузера

- **Uniscan:** `x-sign=456cbba050b7560334ce59a863e41408`, `x-ts=1765934147`
- **InSwap:** `x-sign=d794f6e37228ead1270076fbb4bdf056`, `x-ts=1765934196`

Оба имеют длину 32 символа (hex), что соответствует MD5 или первым 32 символам SHA-256.

